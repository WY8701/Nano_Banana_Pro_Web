<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nano Banana Pro - ç›‘æ§é¢æ¿</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        h1 {
            font-size: 28px;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .refresh-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #fff;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .refresh-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .stat-card .label {
            color: rgba(255,255,255,0.6);
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .stat-card .value {
            font-size: 36px;
            font-weight: bold;
        }
        
        .stat-card .value.blue { color: #00d4ff; }
        .stat-card .value.green { color: #00ff88; }
        .stat-card .value.purple { color: #7b2ff7; }
        .stat-card .value.orange { color: #ff9500; }
        
        .section {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
        }
        
        .section h2 {
            font-size: 18px;
            margin-bottom: 16px;
            color: rgba(255,255,255,0.9);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        th {
            color: rgba(255,255,255,0.6);
            font-weight: normal;
            font-size: 14px;
        }
        
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
        }
        
        .status.completed { background: rgba(0,255,136,0.2); color: #00ff88; }
        .status.failed { background: rgba(255,68,68,0.2); color: #ff4444; }
        .status.processing { background: rgba(0,212,255,0.2); color: #00d4ff; }
        
        .last-update {
            text-align: center;
            color: rgba(255,255,255,0.4);
            font-size: 12px;
            margin-top: 20px;
        }
        
        .api-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .dot.green { background: #00ff88; }
        .dot.red { background: #ff4444; }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: rgba(255,255,255,0.6);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“Š Nano Banana Pro ç›‘æ§é¢æ¿</h1>
            <button class="refresh-btn" onclick="refreshAll()">ğŸ”„ åˆ·æ–°</button>
        </header>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="label">æ€»ç”Ÿæˆå›¾ç‰‡</div>
                <div class="value blue" id="totalImages">-</div>
            </div>
            <div class="stat-card">
                <div class="label">æˆåŠŸ</div>
                <div class="value green" id="successCount">-</div>
            </div>
            <div class="stat-card">
                <div class="label">å¤±è´¥</div>
                <div class="value orange" id="failedCount">-</div>
            </div>
            <div class="stat-card">
                <div class="label">API çŠ¶æ€</div>
                <div class="api-status">
                    <span class="dot" id="apiDot"></span>
                    <span id="apiStatus">æ£€æµ‹ä¸­...</span>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ“ˆ æœ€è¿‘ä»»åŠ¡</h2>
            <table>
                <thead>
                    <tr>
                        <th>ä»»åŠ¡ID</th>
                        <th>çŠ¶æ€</th>
                        <th>æç¤ºè¯</th>
                        <th>åˆ›å»ºæ—¶é—´</th>
                    </tr>
                </thead>
                <tbody id="taskTable">
                    <tr><td colspan="4" class="loading">åŠ è½½ä¸­...</td></tr>
                </tbody>
            </table>
        </div>
        
        <div class="section">
            <h2>ğŸ–¼ï¸ æœ€è¿‘å›¾ç‰‡</h2>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>å°ºå¯¸</th>
                        <th>çŠ¶æ€</th>
                        <th>åˆ›å»ºæ—¶é—´</th>
                    </tr>
                </thead>
                <tbody id="imageTable">
                    <tr><td colspan="4" class="loading">åŠ è½½ä¸­...</td></tr>
                </tbody>
            </table>
        </div>
        
        <div class="last-update">
            æœ€åæ›´æ–°: <span id="lastUpdate">-</span>
        </div>
    </div>
    
    <script>
        const API_BASE = 'http://localhost:8080/api/v1';
        
        async function checkAPI() {
            try {
                const res = await fetch(`${API_BASE}/health`);
                const data = await res.json();
                document.getElementById('apiDot').className = 'dot green';
                document.getElementById('apiStatus').textContent = 'æ­£å¸¸';
                return true;
            } catch (e) {
                document.getElementById('apiDot').className = 'dot red';
                document.getElementById('apiStatus').textContent = 'å¼‚å¸¸';
                return false;
            }
        }
        
        async function loadImages() {
            try {
                const res = await fetch(`${API_BASE}/images?limit=10`);
                const data = await res.json();
                const images = data.data || [];
                
                document.getElementById('totalImages').textContent = images.length;
                
                const success = images.filter(i => i.status === 'completed').length;
                const failed = images.filter(i => i.status === 'failed').length;
                
                document.getElementById('successCount').textContent = success;
                document.getElementById('failedCount').textContent = failed;
                
                // æ›´æ–°å›¾ç‰‡è¡¨æ ¼
                const tbody = document.getElementById('imageTable');
                if (images.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" class="loading">æš‚æ— æ•°æ®</td></tr>';
                } else {
                    tbody.innerHTML = images.map(img => `
                        <tr>
                            <td>${img.id?.slice(0,8) || '-'}</td>
                            <td>${img.width || 0} Ã— ${img.height || 0}</td>
                            <td><span class="status ${img.status || 'completed'}">${img.status || 'completed'}</span></td>
                            <td>${formatTime(img.created_at)}</td>
                        </tr>
                    `).join('');
                }
                
                return images;
            } catch (e) {
                console.error('åŠ è½½å›¾ç‰‡å¤±è´¥:', e);
                return [];
            }
        }
        
        async function loadTasks() {
            try {
                const res = await fetch(`${API_BASE}/tasks?limit=10`);
                const data = await res.json();
                const tasks = data.data || [];
                
                // æ›´æ–°ä»»åŠ¡è¡¨æ ¼
                const tbody = document.getElementById('taskTable');
                if (tasks.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" class="loading">æš‚æ— æ•°æ®</td></tr>';
                } else {
                    tbody.innerHTML = tasks.map(task => `
                        <tr>
                            <td>${task.task_id?.slice(0,12) || '-'}</td>
                            <td><span class="status ${task.status}">${task.status}</span></td>
                            <td>${(task.prompt || '-').slice(0,30)}...</td>
                            <td>${formatTime(task.created_at)}</td>
                        </tr>
                    `).join('');
                }
                
                return tasks;
            } catch (e) {
                console.error('åŠ è½½ä»»åŠ¡å¤±è´¥:', e);
                return [];
            }
        }
        
        async function loadProviders() {
            try {
                const res = await fetch(`${API_BASE}/providers/config`);
                const data = await res.json();
                const providers = data.data || [];
                
                // æ˜¾ç¤º Provider çŠ¶æ€
                providers.forEach(p => {
                    console.log(`Provider: ${p.provider_name}, Enabled: ${p.enabled}`);
                });
                
                return providers;
            } catch (e) {
                console.error('åŠ è½½Providerå¤±è´¥:', e);
                return [];
            }
        }
        
        function formatTime(timeStr) {
            if (!timeStr) return '-';
            try {
                const date = new Date(timeStr);
                return date.toLocaleString('zh-CN');
            } catch {
                return timeStr;
            }
        }
        
        async function refreshAll() {
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString('zh-CN');
            await Promise.all([
                checkAPI(),
                loadImages(),
                loadTasks(),
                loadProviders()
            ]);
        }
        
        // åˆå§‹åŠ è½½
        refreshAll();
        
        // æ¯30ç§’è‡ªåŠ¨åˆ·æ–°
        setInterval(refreshAll, 30000);
    </script>
</body>
</html>